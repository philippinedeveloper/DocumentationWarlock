<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocsGenerator Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .container {
            width: 500px;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress {
            height: 100%;
            width: 0;
            background: #4caf50;
            transition: width 0.3s;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>DocsGenerator Tool</h2>
    <p>Select an .aix file to generate documentation:</p>
    <input type="file" id="fileInput" accept=".aix" />
    <div class="progress-bar hidden" id="progressBar">
        <div class="progress" id="progress"></div>
    </div>
    <div id="result"></div>
    <button id="generate">Generate Documentation</button>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const result = document.getElementById('result');
    const generateButton = document.getElementById('generate');
    
    let selectedFile = null;

    fileInput.addEventListener('change', (event) => {
        selectedFile = event.target.files[0];
    });

    generateButton.addEventListener('click', () => {
        if (!selectedFile) {
            alert('Please choose an .aix file!');
            return;
        }
        
        const reader = new FileReader();

        reader.onload = async (e) => {
            progressBar.classList.remove('hidden');
            progress.style.width = '10%';

            try {
                const zip = await JSZip.loadAsync(e.target.result);
                const componentsJsonFile = Object.keys(zip.files).find(file => file.endsWith('components.json'));

                if (!componentsJsonFile) {
                    throw new Error('components.json not found in the .aix file');
                }

                progress.style.width = '30%';
                const componentsContent = await zip.file(componentsJsonFile).async('text');
                const components = JSON.parse(componentsContent);

                let documentation = '';

                components.forEach((component, index) => {
                    documentation += `<h2>Docs for: ${component.name}</h2>`;

                    if (component.events.length) {
                        documentation += '<h3>Events</h3>';
                        component.events.forEach(event => {
                            documentation += `<h4>${event.name}</h4><p>${event.description}</p>`;
                            if (event.params.length) {
                                documentation += '<table border="1"><tr><th>Param</th><th>Type</th></tr>';
                                event.params.forEach(param => {
                                    documentation += `<tr><td>${param.name}</td><td>${param.type}</td></tr>`;
                                });
                                documentation += '</table>';
                            }
                        });
                    }

                    if (component.methods.length) {
                        documentation += '<h3>Methods</h3>';
                        component.methods.forEach(method => {
                            documentation += `<h4>${method.name}</h4><p>${method.description}</p>`;
                            if (method.params.length) {
                                documentation += '<table border="1"><tr><th>Param</th><th>Type</th></tr>';
                                method.params.forEach(param => {
                                    documentation += `<tr><td>${param.name}</td><td>${param.type}</td></tr>`;
                                });
                                documentation += '</table>';
                            }
                            if (method.returnType) {
                                documentation += `<p>Return type: ${method.returnType}</p>`;
                            }
                        });
                    }

                    if (component.blockProperties.length) {
                        documentation += '<h3>Block Properties</h3>';
                        component.blockProperties.forEach(property => {
                            documentation += `<h4>${property.name}</h4><p>${property.description}</p>`;
                            if (property.rw) {
                                documentation += `<p>Property Type: ${property.rw}</p>`;
                            }
                            if (property.type) {
                                documentation += `<p>Accepts: ${property.type}</p>`;
                            }
                            if (property.returnType) {
                                documentation += `<p>Return type: ${property.returnType}</p>`;
                            }
                        });
                    }

                    if (component.designerProperties?.length) {
                        documentation += '<h3>Designer Properties</h3>';
                        component.designerProperties.forEach(property => {
                            documentation += `<h4>${property.name}</h4><p>${property.description}</p>`;
                            if (property.defaultValue) {
                                documentation += `<p>Default Value: ${property.defaultValue}</p>`;
                            }
                            if (property.type) {
                                documentation += `<p>Type: ${property.type}</p>`;
                            }
                        });
                    }
                });

                result.innerHTML = documentation;
                progress.style.width = '100%';
            } catch (error) {
                alert(error.message);
            } finally {
                progressBar.classList.add('hidden');
                progress.style.width = '0';
            }
        };

        reader.readAsArrayBuffer(selectedFile);
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</body>
</html>
